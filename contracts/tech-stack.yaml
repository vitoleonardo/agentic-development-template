# ============================================================================
# TECH STACK - Fixed choices for this template
# ============================================================================
# Single source of truth. Agents MUST use these; no re-evaluation.
# Rationale: simplicity, fewer tokens, less code, existing solutions.
# ============================================================================

meta:
  version: "1.0"
  updated: "2024-01-01"

# -----------------------------------------------------------------------------
# FIXED STACK (do not substitute)
# -----------------------------------------------------------------------------
stack:

  framework:
    name: Next.js
    role: fullstack
    version: ">=14"
    notes: "App Router, RSC, API routes, Server Actions. No separate API server."

  auth:
    name: NextAuth
    version: ">=5"
    notes: "Auth.js; use built-in adapters (e.g. Prisma). No custom auth from scratch."

  ui:
    components: shadcn/ui
    styling: Tailwind CSS
    tailwind-version: "3"
    notes: "shadcn + Tailwind only. No custom design system or extra CSS framework."

  database:
    engine: PostgreSQL
    orm: Prisma
    notes: "Prisma for schema, migrations, client. No raw SQL or other ORMs."

  runtime:
    container: Docker
    notes: "Docker Compose for local Postgres + app. One docker-compose.yml."

  validation:
    name: Zod
    notes: "Env, API, forms. One validation lib."

  lint-format:
    name: Biome
    notes: "Lint + format in one tool. No ESLint + Prettier."

  test:
    unit: Vitest
    e2e: Playwright
    notes: "Vitest for unit; Playwright for visual/e2e. No Jest."

# -----------------------------------------------------------------------------
# DIRECTORY CONVENTIONS (Next.js App Router)
# -----------------------------------------------------------------------------
conventions:
  entry: src/app/layout.tsx
  routes: "src/app/**/page.tsx"
  api: src/app/api/
  components: src/components/
  features: src/features/  # or app/(features)/ if using route groups
  lib: src/lib/
  types: src/types/
  no-router-dir: true  # No src/router/*; file-based routing only

# -----------------------------------------------------------------------------
# GROWTH PATH — When features and business logic grow
# -----------------------------------------------------------------------------
# See contracts/monorepo.yaml for full spec.
#
# When to add: Features and business logic outgrow Next.js API routes.
# Then: Create monorepo, add separate backend, use shared lib for models.
#
# Backend:
#   runtime: Deno
#   framework: Express (simpler) or NestJS (higher complexity)
#   tooling: Deno built-in (deno lint, deno test, deno fmt) — no extra config
#
# Monorepo layout:
#   apps/web     — Next.js (existing app)
#   apps/api     — Deno backend (Express or NestJS)
#   packages/shared — Types, Zod schemas, constants (single source; no duplicate models)
#
# Rule: Define models/schemas once in packages/shared. Consume from apps/web and
#       apps/api. Do not duplicate type or schema definitions.

growth-path:
  trigger: "Features and business logic grow beyond Next.js API routes"
  monorepo: true
  backend:
    runtime: Deno
    framework:
      simple: Express
      complex: NestJS
    tooling: "Deno built-in: deno lint, deno test, deno fmt, deno check"
  shared-package:
    path: packages/shared
    contents: [types, zod-schemas, constants]
    rule: "Define models once; no duplicate definitions across apps"

# -----------------------------------------------------------------------------
# FORBIDDEN (saves tokens and code)
# -----------------------------------------------------------------------------
forbidden:
  - "Separate API server with Node (use Deno when adding backend; see growth-path)"
  - "ESLint + Prettier (use Biome on Node side; Deno built-in on backend)"
  - "Raw SQL or Drizzle/Kysely (use Prisma)"
  - "Custom auth implementation (use NextAuth)"
  - "Another UI library (MUI, Chakra, etc.)"
  - "CSS-in-JS or Sass (use Tailwind only)"
  - "Jest (use Vitest)"
  - "Multiple form libraries (pick one: react-hook-form + Zod)"
  - "Duplicate model/type definitions (use packages/shared when in monorepo)"

# -----------------------------------------------------------------------------
# RECOMMENDED ADDITIONS (minimal set)
# -----------------------------------------------------------------------------
recommended:
  - "Prisma — ORM, migrations, type-safe client"
  - "Zod — env + API + form validation"
  - "class-variance-authority + tailwind-merge — shadcn class handling"
  - "lucide-react — icons (shadcn default)"

# -----------------------------------------------------------------------------
# HANDY CANDIDATES — Use these instead of rolling your own
# -----------------------------------------------------------------------------
# One choice per concern; avoids custom code and token waste.
handy-candidates:

  forms:
    - package: "react-hook-form"
      use: "Forms; pair with @hookform/resolvers and zodResolver(ZodSchema)"
      avoid: "Multiple form libs; raw controlled inputs for complex forms"

  toasts:
    - package: "sonner"
      use: "Toasts (shadcn-compatible); fits design.yaml ux.feedback: toast"
      avoid: "Custom toast state; react-hot-toast ok but sonner fits shadcn"

  theme:
    - package: "next-themes"
      use: "Light/dark/system theme; fits design.yaml theme.mode"
      avoid: "Custom theme context and localStorage"

  dates:
    - package: "date-fns"
      use: "Date formatting, parsing, relative time; small, tree-shakeable"
      avoid: "moment (heavy); dayjs ok but date-fns is smaller per-use"

  ids:
    - package: "nanoid"
      use: "Short unique IDs (DB, client keys)"
      avoid: "uuid unless you need UUID format; crypto.randomUUID in browser is ok for one-offs"
